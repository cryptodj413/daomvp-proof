{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Google Profile + FHIR R4 EMR Bundle Proof",
  "type": "object",
  "required": ["userId", "email", "timestamp", "profile", "metadata", "entry"],
  "properties": {
    "userId": { "type": "string" },
    "email": { "type": "string", "format": "email" },
    "timestamp": { "type": "number" },
    "profile": {
      "type": "object",
      "required": ["name", "locale"],
      "properties": {
        "name": { "type": "string" },
        "locale": { "type": "string" }
      }
    },
    "storage": {
      "type": "object",
      "properties": {
        "percentUsed": { "type": "number" }
      }
    },
    "metadata": {
      "type": "object",
      "required": ["source", "collectionDate", "dataType"],
      "properties": {
        "source": { "type": "string" },
        "collectionDate": { "type": "string", "format": "date-time" },
        "dataType": { "type": "string" }
      }
    },
    "entry": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["fullUrl", "resource", "request"],
        "properties": {
          "fullUrl": { "type": "string" },
          "resource": {
            "type": "object",
            "oneOf": [
              { "$ref": "#/definitions/patient" },
              { "$ref": "#/definitions/encounter" },
              { "$ref": "#/definitions/condition" },
              { "$ref": "#/definitions/procedure" },
              { "$ref": "#/definitions/immunization" },
              { "$ref": "#/definitions/diagnosticReport" },
              { "$ref": "#/definitions/device" },
              { "$ref": "#/definitions/supplyDelivery" },
              { "$ref": "#/definitions/explanationOfBenefit" },
              { "$ref": "#/definitions/medication" },
              { "$ref": "#/definitions/medicationRequest" },
              { "$ref": "#/definitions/claim" },
              { "$ref": "#/definitions/documentReference" }
            ]
          },
          "request": {
            "type": "object",
            "required": ["method", "url"],
            "properties": {
              "method": { "type": "string", "enum": ["POST"] },
              "url": { "type": "string" }
            }
          }
        }
      }
    }
  },

  "definitions": {
    "patient": {
      "type": "object",
      "required": ["resourceType", "id", "gender", "birthDate"],
      "properties": {
        "resourceType": { "type": "string", "enum": ["Patient"] },
        "id": { "type": "string" },
        "gender": { "type": "string" },
        "birthDate": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
        "name": { "type": "array", "items": { "type": "object" } },
        "identifier": { "type": "array", "items": { "type": "object" } },
        "telecom": { "type": "array", "items": { "type": "object" } },
        "address": { "type": "array", "items": { "type": "object" } },
        "maritalStatus": { "type": "object" },
        "communication": { "type": "array", "items": { "type": "object" } }
      },
      "additionalProperties": true
    },

    "encounter": {
      "type": "object",
      "required": ["resourceType", "status", "class", "subject", "period"],
      "properties": {
        "resourceType": { "type": "string", "enum": ["Encounter"] },
        "id": { "type": "string" },
        "status": { "type": "string" },
        "class": { "type": "object" },
        "subject": { "type": "object" },
        "period": { "type": "object" }
      },
      "additionalProperties": true
    },

    "condition": {
      "type": "object",
      "required": ["resourceType", "id", "subject", "code"],
      "properties": {
        "resourceType": { "type": "string", "enum": ["Condition"] },
        "id": { "type": "string" },
        "subject": { "type": "object" },
        "code": { "type": "object" },
        "onsetDateTime": { "type": "string", "format": "date-time" }
      },
      "additionalProperties": true
    },

    "procedure": {
      "type": "object",
      "required": ["resourceType", "status", "code", "subject"],
      "properties": {
        "resourceType": { "type": "string", "enum": ["Procedure"] },
        "id": { "type": "string" },
        "status": { "type": "string" },
        "code": { "type": "object" },
        "subject": { "type": "object" }
      },
      "additionalProperties": true
    },

    "immunization": {
      "type": "object",
      "required": ["resourceType", "status", "vaccineCode", "patient"],
      "properties": {
        "resourceType": { "type": "string", "enum": ["Immunization"] },
        "id": { "type": "string" },
        "status": { "type": "string" },
        "vaccineCode": { "type": "object" },
        "patient": { "type": "object" }
      },
      "additionalProperties": true
    },

    "diagnosticReport": {
      "type": "object",
      "required": ["resourceType", "status", "code", "subject"],
      "properties": {
        "resourceType": { "type": "string", "enum": ["DiagnosticReport"] },
        "id": { "type": "string" },
        "status": { "type": "string" },
        "code": { "type": "object" },
        "subject": { "type": "object" }
      },
      "additionalProperties": true
    },

    "device": {
      "type": "object",
      "required": ["resourceType", "id", "status", "type"],
      "properties": {
        "resourceType": { "type": "string", "enum": ["Device"] },
        "id": { "type": "string" },
        "status": { "type": "string" },
        "type": { "type": "object" }
      },
      "additionalProperties": true
    },

    "supplyDelivery": {
      "type": "object",
      "required": ["resourceType", "status", "patient"],
      "properties": {
        "resourceType": { "type": "string", "enum": ["SupplyDelivery"] },
        "id": { "type": "string" },
        "status": { "type": "string" },
        "patient": { "type": "object" }
      },
      "additionalProperties": true
    },

    "explanationOfBenefit": {
      "type": "object",
      "required": ["resourceType", "status", "type", "patient"],
      "properties": {
        "resourceType": { "type": "string", "enum": ["ExplanationOfBenefit"] },
        "id": { "type": "string" },
        "status": { "type": "string" },
        "type": { "type": "object" },
        "patient": { "type": "object" }
      },
      "additionalProperties": true
    },

    "medication": {
      "type": "object",
      "required": ["resourceType", "code"],
      "properties": {
        "resourceType": { "type": "string", "enum": ["Medication"] },
        "id": { "type": "string" },
        "code": { "type": "object" }
      },
      "additionalProperties": true
    },

    "medicationRequest": {
      "type": "object",
      "required": ["resourceType", "status", "intent", "subject"],
      "properties": {
        "resourceType": { "type": "string", "enum": ["MedicationRequest"] },
        "id": { "type": "string" },
        "status": { "type": "string" },
        "intent": { "type": "string" },
        "subject": { "type": "object" }
      },
      "additionalProperties": true
    },

    "claim": {
      "type": "object",
      "required": ["resourceType", "status", "type", "patient"],
      "properties": {
        "resourceType": { "type": "string", "enum": ["Claim"] },
        "id": { "type": "string" },
        "status": { "type": "string" },
        "type": { "type": "object" },
        "patient": { "type": "object" }
      },
      "additionalProperties": true
    },

    "documentReference": {
      "type": "object",
      "required": ["resourceType", "status", "content"],
      "properties": {
        "resourceType": { "type": "string", "enum": ["DocumentReference"] },
        "id": { "type": "string" },
        "status": { "type": "string" },
        "content": { "type": "array", "items": { "type": "object" } }
      },
      "additionalProperties": true
    }
  }
}
